# Sample workflow for building and deploying a Hugo site to GitHub Pages
name: Deploy Hugo site to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # Build job
  build_and_install:
    runs-on: self-hosted
    env:
      HUGO_BIN: "/snap/bin/hugo"
      PUBLIC_HTML: ${{ github.ref == 'refs/heads/main' && '/home/resconda/resconda.it/resconda.it-hugo' || '/home/resconda/resconda.it/staging' }}
      PUBLIC_URL: ${{ github.ref == 'refs/heads/main' && 'https://resconda.it' || 'https://resconda.it:44443' }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: Build with Hugo and deploy to PUBLIC_HTML
        env:
          # For maximum backward compatibility with Hugo modules
          HUGO_ENVIRONMENT: production
          HUGO_ENV: production
        run: |
          set -x
          cd ${{ github.workspace }} && \
          $HUGO_BIN \
            --minify \
            --baseURL "$PUBLIC_URL" \
            -d $PUBLIC_HTML

